<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOK Prompt Mosaic — Unpacking the 35 Knowledge Questions</title>
  <style>
    :root{
      --bg:#0b1220;
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;

      /* Knowledge Framework accents */
      --kf-perspectives:#34d399;  /* green */
      --kf-scope:#60a5fa;         /* blue */
      --kf-methods:#fbbf24;       /* amber */
      --kf-ethics:#a78bfa;        /* violet */

      --panelA: rgba(255,255,255,.08);
      --panelB: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.14);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 800px at 15% 10%, rgba(96,165,250,.16), transparent 60%),
        radial-gradient(1200px 800px at 85% 0%, rgba(167,139,250,.14), transparent 55%),
        radial-gradient(1100px 900px at 70% 100%, rgba(52,211,153,.12), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height:100vh;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:28px 18px 42px}
    header{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      margin-bottom:18px;
    }

    .title{display:flex;flex-direction:column;gap:6px}
    h1{margin:0;font-size: clamp(20px, 2.2vw, 32px);letter-spacing:.2px}
    .sub{
      color:var(--muted);
      font-size:14px;
      line-height:1.35;
      max-width: 76ch;
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .input, .select{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      outline: none;
      box-shadow: 0 12px 35px rgba(0,0,0,.22);
      transition: border-color .2s ease, background .2s ease;
      font-size: 14px;
    }
    .input{min-width:260px}
    .input:focus,.select:focus{border-color: rgba(96,165,250,.7); background: rgba(255,255,255,.08);}

    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
    }
    @media (max-width: 1100px){ .grid{grid-template-columns: repeat(10, 1fr);} }
    @media (max-width: 860px){
      .grid{grid-template-columns: repeat(6, 1fr);}
      .input{min-width: 100%;}
      header{align-items:stretch}
      .controls{justify-content:stretch}
      .select{flex:1}
    }
    @media (max-width: 520px){ .grid{grid-template-columns: repeat(4, 1fr);} }

    /* UNIFORM tiles */
    .card{
      grid-column: span 3;
      height: 168px; /* uniform proportion */
      background: linear-gradient(180deg, var(--panelA), var(--panelB));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px 12px 10px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transition: transform .14s ease, border-color .14s ease, background .14s ease;
      display:flex;
      flex-direction:column;
    }
    @media (max-width: 860px){
      .card{ grid-column: span 2; }
    }
    @media (max-width: 520px){
      .card{ grid-column: span 2; height: 178px; }
    }

    .card:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); }
    .card:active{ transform: translateY(0px) scale(.995); }

    .topline{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:8px;
      flex:0 0 auto;
    }
    .num{
      font-weight: 800;
      font-size: 13px;
      padding: 6px 9px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      letter-spacing:.2px;
    }
    .pill{
      font-size:12px;
      color: rgba(255,255,255,.86);
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      white-space:nowrap;
      display:flex;
      align-items:center;
      gap:7px;
    }
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block;opacity:.95}

    .q{
      margin:0 0 10px 0;
      font-size: 15px;
      line-height:1.22;
      font-weight: 800;
      letter-spacing:.1px;
      flex:0 0 auto;
    }
    .mini{
      margin:0;
      color: var(--muted);
      font-size: 12.8px;
      line-height:1.3;
      overflow:hidden;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      margin-top:auto; /* keeps consistent spacing */
    }

    .accentBar{
      position:absolute; inset:auto 0 0 0;
      height: 6px;
      opacity:.95;
    }

    /* Drawer */
    .backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
    }
    .drawer{
      position:fixed;
      top:0; right:0;
      height:100%;
      width:min(520px, 92vw);
      background: rgba(12,18,32,.96);
      border-left: 1px solid rgba(255,255,255,.14);
      box-shadow: -30px 0 80px rgba(0,0,0,.55);
      transform: translateX(105%);
      transition: transform .22s ease;
      display:flex;
      flex-direction:column;
    }
    .drawer.open{ transform: translateX(0); }
    .backdrop.show{ display:block; }

    .drawerHeader{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .drawerHeader h2{ margin:0; font-size: 18px; line-height:1.2; }
    .drawerHeader .meta{
      margin-top:6px;
      display:flex; flex-wrap:wrap; gap:8px;
    }
    .xbtn{
      appearance:none;
      border:none;
      color:var(--text);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      font-weight:700;
    }
    .xbtn:hover{ background: rgba(255,255,255,.10); }

    .drawerBody{
      padding: 14px 16px 18px;
      overflow:auto;
    }
    .section{
      margin-bottom: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .label{
      font-size: 12px;
      letter-spacing:.25px;
      text-transform: uppercase;
      color: rgba(255,255,255,.70);
      margin-bottom: 6px;
      display:flex; align-items:center; gap:8px;
    }
    .text{
      margin:0;
      color: rgba(255,255,255,.92);
      line-height:1.42;
      font-size: 14px;
      white-space:pre-wrap;
    }

    .footer{
      margin-top: 10px;
      color: rgba(255,255,255,.60);
      font-size: 12px;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>The TOK Prompt Mosaic</h1>
        <div class="sub">
          Click any prompt for deconstruction. <br>
          <strong>Teacher Note:</strong> This tool is aligned to the <em>Exhibition</em>. Guidance focuses on linking specific objects to knowledge claims.
        </div>
      </div>

      <div class="controls">
        <input id="search" class="input" type="search" placeholder="Search (e.g., bias, experts, culture, senses)…" />
        <select id="kfFilter" class="select">
          <option value="all">Filter: Knowledge Framework (all)</option>
        </select>
      </div>
    </header>

    <main id="grid" class="grid" aria-label="TOK prompt mosaic grid"></main>

    <div class="footer">
      Revised for TOK Exhibition alignment: Focuses on object-based justification and real-world contexts.
    </div>
  </div>

  <!-- Drawer -->
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>
  <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-label="Prompt details">
    <div class="drawerHeader">
      <div>
        <h2 id="dTitle">Prompt</h2>
        <div class="meta" id="dMeta"></div>
      </div>
      <button class="xbtn" id="closeBtn" aria-label="Close details">✕</button>
    </div>
    <div class="drawerBody" id="dBody"></div>
  </aside>

  <script>
    // -----------------------------------------
    // KNOWLEDGE FRAMEWORK LABELS (fixed set)
    // -----------------------------------------
    const KF = {
      "Perspectives": { color: "var(--kf-perspectives)", keywords: ["perspective","bias","culture","audience","experts","trust","community","interpretation"] },
      "Scope":        { color: "var(--kf-scope)",        keywords: ["counts as","definition","certainty","limits","unknowable","improvement","history","ownership","classification","knowledge/belief/opinion"] },
      "Methods & Tools":{ color:"var(--kf-methods)",     keywords: ["evidence","justification","methods","tools","senses","explanation","dissemination","communication","presentation"] },
      "Ethics":       { color: "var(--kf-ethics)",       keywords: ["ethical","obligations","should","responsibility","values","dangerous","not be sought"] }
    };

    function inferKF(d){
      if(Array.isArray(d.kf) && d.kf.length) return d.kf;

      const hay = [
        d.q, d.translation, d.hidden, d.guidance
      ].join(" ").toLowerCase();

      const hits = [];
      for(const [label, cfg] of Object.entries(KF)){
        if(cfg.keywords.some(k => hay.includes(k))) hits.push(label);
      }
      return hits.length ? hits : ["Scope"];
    }

    function kfColor(label){ return (KF[label]?.color) || "rgba(255,255,255,.35)"; }

    // ----------------------------
    // DATA
    // REVISED for Exhibition Alignment:
    // Focus is now on "The Object" and specific links, not generic essay debating.
    // ----------------------------
    const DATA = [
      { n:1, q:"What counts as knowledge?",
        translation:"Where do we draw the line between mere 'information' (or belief) and accepted 'knowledge'?",
        hidden:"Standards for 'counting' change depending on the context. What counts in a courtroom doesn't count in a laboratory.",
        guidance:"Choose an object that sits on the boundary. Does your object represent something that was rejected as knowledge? Or something accepted only by a specific group? Explain the criteria used to include/exclude it."
      },
      { n:2, q:"Are some types of knowledge more useful than others?",
        translation:"Does utility define the value of knowledge?",
        hidden:"'Useful' is subjective. Knowledge can be useless for survival but vital for meaning (e.g., poetry vs. farming).",
        guidance:"Avoid listing useful things. Select an object that challenges the definition of 'useful.' Is it useful for profit? For the soul? For whom is it useful, and who is it useless for?"
      },
      { n:3, q:"What features of knowledge have an impact on its reliability?",
        translation:"What makes us trust this specific piece of knowledge?",
        hidden:"Reliability isn't just about 'facts.' It comes from methodology, peer review, longevity, or the authority of the source.",
        guidance:"Don't just write about 'reliability' in general. Show how *this specific object* gains (or loses) reliability. Is it the author's credentials? The age of the object? The method used to create it?"
      },
      { n:4, q:"On what grounds might we doubt a claim?",
        translation:"When is it reasonable to reject or question this claim?",
        hidden:"Doubt can be healthy (scientific skepticism) or corrosive (denialism). The tension is distinguishing between the two.",
        guidance:"Choose an object that was effectively doubted, or one that *should* be doubted. Explicitly state the 'grounds' (the reasons) shown in the object—e.g., lack of evidence, bias of the source, or conflict with established theory."
      },
      { n:5, q:"What counts as good evidence for a claim?",
        translation:"What proof is required to make this claim stick?",
        hidden:"'Good' evidence varies entirely by AOK. A personal diary is good evidence in history/psychology but bad evidence in physics.",
        guidance:"Select an object that serves as evidence. Explain why it is considered 'good' (or bad) evidence *in its specific context*. Does it rely on data, testimony, or physical presence?"
      },
      { n:6, q:"How does the way that we organize or classify knowledge affect what we know?",
        translation:"Does the label we put on this change how we understand it?",
        hidden:"Classification isn't neutral. Grouping things changes how we see relationships and value.",
        guidance:"Find an object that represents a category (e.g., a biological taxonomy, a library genre, a legal status). Show how changing its classification would change what we 'know' about it."
      },
      { n:7, q:"What are the implications of having, or not having, knowledge?",
        translation:"What are the real-world consequences of this knowledge existing (or being hidden)?",
        hidden:"Knowledge is power, but also liability. Ignorance can be bliss, or it can be fatal.",
        guidance:"Focus on the 'So what?' Connect your object to a specific consequence. Because this knowledge existed (or was lost), what happened to people? Who benefited?"
      },
      { n:8, q:"To what extent is certainty attainable?",
        translation:"Can we ever be 100% sure about this?",
        hidden:"We often have to act without full certainty. The tension is between the desire for truth and the reality of doubt.",
        guidance:"Don't argue generally about math vs. art. Choose an object that claims certainty (e.g., a measurement tool) or one that highlights uncertainty (e.g., a probability model). Show where the certainty breaks down."
      },
      { n:9, q:"Are some types of knowledge less open to interpretation than others?",
        translation:"Is this fact 'fixed', or does it depend on who is looking at it?",
        hidden:"Even 'hard facts' (data) require interpretation. The tension is in how much 'wiggle room' is allowed.",
        guidance:"Select an object that seems rigid (like a formula) or very open (like a poem). Demonstrate specifically *where* the interpretation happens. Is it in the reading? The application? The translation?"
      },
      { n:10, q:"What challenges are raised by the dissemination and/or communication of knowledge?",
        translation:"What happens when we try to share this idea with others?",
        hidden:"The act of communicating often simplifies or distorts the message. The map is not the territory.",
        guidance:"Choose an object that communicates knowledge (a map, a textbook, a tweet). Show what was lost or changed when the knowledge was put into this format."
      },
      { n:11, q:"Can new knowledge change established values or beliefs?",
        translation:"Does learning a new fact change what we believe is 'right'?",
        hidden:"Cognitive dissonance: we often reject facts that clash with our values. Knowledge doesn't automatically update belief.",
        guidance:"Find an object that represented a turning point. Did this specific discovery force a change in values? Or did people reject the object to protect their beliefs?"
      },
      { n:12, q:"Is bias inevitable in the production of knowledge?",
        translation:"Is it possible to create this without a specific perspective?",
        hidden:"Bias isn't always bad; it's a filter. We can't notice everything, so we must choose what to focus on.",
        guidance:"Do not just say 'everyone is biased.' Show how the creator's bias is *physically present* in the object. What did they choose to include? What did they leave out?"
      },
      { n:13, q:"How can we know that current knowledge is an improvement upon past knowledge?",
        translation:"Is this really 'better' than what we had before?",
        hidden:"Progress isn't linear. 'Newer' might just be 'more profitable' or 'more popular,' not truer.",
        guidance:"Select an object that replaced an older one. Prove it is an improvement using specific criteria (accuracy, speed, ethics). Or, choose one that shows we haven't actually improved."
      },
      { n:14, q:"Does some knowledge belong only to particular communities of knowers?",
        translation:"Is this knowledge 'ours' and not 'yours'?",
        hidden:"The tension between universal knowledge (science for all) and cultural property (indigenous knowledge, trade secrets).",
        guidance:"Choose an object that is restricted or protected (e.g., a sacred artifact, a classified document, a family recipe). Explain *why* the community claims ownership over it."
      },
      { n:15, q:"What constraints are there on the pursuit of knowledge?",
        translation:"What stops us from knowing more about this?",
        hidden:"Constraints can be technical, financial, or ethical. Just because we *can* know it, doesn't mean we *can* get it.",
        guidance:"Show the wall. Choose an object that represents a limit—technology that failed, an experiment that was banned, or funding that was cut. What specifically constrained the knowledge?"
      },
      { n:16, q:"Should some knowledge not be sought on ethical grounds?",
        translation:"Is there knowledge we are better off not having?",
        hidden:"The clash between curiosity/progress and harm/morality.",
        guidance:"Select an object associated with controversial research (e.g., weapon development, unethical experiments). Don't just say 'it's bad.' Explain the specific ethical line that was crossed to create the object."
      },
      { n:17, q:"Why do we seek knowledge?",
        translation:"What was the driving force behind creating this object?",
        hidden:"It's rarely just 'to know.' It's usually for power, profit, survival, or ego.",
        guidance:"Identify the specific motivation behind your object. Was it created to solve a problem? To win a war? To prove someone wrong? Show how the motive shaped the result."
      },
      { n:18, q:"Are some things unknowable?",
        translation:"Is there a hard limit to what this object can tell us?",
        hidden:"Distinguish between 'we don't know yet' and 'we can never know' (e.g., the future, the subjective experience of others).",
        guidance:"Choose an object that attempts to represent the unrepresentable (e.g., a simulation of the future, a depiction of god, a model of the mind). Show what remains captured vs. what remains unknowable."
      },
      { n:19, q:"What counts as a good justification for a claim?",
        translation:"Why should we believe the claim this object makes?",
        hidden:"Justification depends on context. 'Because I saw it' is good for an eyewitness, bad for a physicist.",
        guidance:"Focus on the 'Why'. Does the object rely on logic, empirical data, or divine authority? Explain why that specific justification is accepted in the object's context."
      },
      { n:20, q:"What is the relationship between personal experience and knowledge?",
        translation:"How did 'living through it' contribute to this knowledge?",
        hidden:"Experience is rich but anecdotal. It needs to be generalized to become 'knowledge'.",
        guidance:"Select an object that captures a personal experience (a diary, a memoir, a patient log). Show how this subjective experience relates to objective facts. Do they align or conflict?"
      },
      { n:21, q:"What is the relationship between knowledge and culture?",
        translation:"How does the culture of the creator shape this object?",
        hidden:"We think facts are neutral, but culture determines what questions we ask and what answers we accept.",
        guidance:"Choose an object that would not make sense in a different culture. Show how specific cultural values or symbols are embedded in the object itself."
      },
      { n:22, q:"What role do experts play in influencing our consumption or acquisition of knowledge?",
        translation:"Did we accept this just because an 'expert' said so?",
        hidden:"Reliance on authority vs. critical thinking. We need experts, but they can be wrong.",
        guidance:"Choose an object endorsed by an expert (a certificate, a medical recommendation, a critique). Did the expert's stamp of authority validate the object? What if they were wrong?"
      },
      { n:23, q:"How important are material tools in the production or acquisition of knowledge?",
        translation:"Could we know this without the tool?",
        hidden:"Tools aren't passive; they shape the data. A telescope changes the stars into visual data.",
        guidance:"Center the tool. Choose an object that IS a tool (microscope, survey, algorithm). Show how the tool didn't just 'find' the knowledge, but helped 'construct' it."
      },
      { n:24, q:"How might the context in which knowledge is presented influence whether it is accepted or rejected?",
        translation:"Did the packaging sell the idea?",
        hidden:"Truth often matters less than rhetoric, design, and platform.",
        guidance:"Select an object where the 'packaging' was key (e.g., a propaganda poster, a slickly designed graph, a formal legal document). Show how the presentation made the content seem more true."
      },
      { n:25, q:"How can we distinguish between knowledge, belief and opinion?",
        translation:"Is the object a fact, a hope, or a perspective?",
        hidden:"The boundaries are blurry. Opinions can harden into beliefs; beliefs can be asserted as knowledge.",
        guidance:"Choose a borderline object. Is it a historical 'fact' that is actually opinion? Is it a scientific 'theory' treated as belief? Show the difficulty in categorizing it."
      },
      { n:26, q:"Does our knowledge depend on our interactions with other knowers?",
        translation:"Could one person have created this alone?",
        hidden:"Knowledge is a social web. We stand on the shoulders of giants, but we also fall for groupthink.",
        guidance:"Select an object that is the result of collaboration (a Wikipedia edit, a treaty, a scientific paper). Show how the interaction between people modified the final result."
      },
      { n:27, q:"Does all knowledge impose ethical obligations on those who possess it?",
        translation:"Now that you have this object, what are you required to do?",
        hidden:"The burden of knowing. If you know a crime happened, must you report it?",
        guidance:"Choose an object that carries a duty (e.g., a medical diagnosis, a whistleblower's report). Explain the specific obligation it places on the holder."
      },
      { n:28, q:"To what extent is objectivity possible in the production or acquisition of knowledge?",
        translation:"Can this object ever be truly neutral?",
        hidden:"Total neutrality is impossible. The goal is usually 'mitigated subjectivity.'",
        guidance:"Don't just say 'nothing is objective.' Choose an object that *tries* to be objective (a camera, a sensor, a news report). Show the specific limitations of its objectivity."
      },
      { n:29, q:"Who owns knowledge?",
        translation:"Is this object private property or a public good?",
        hidden:"Intellectual property laws vs. the moral right to information.",
        guidance:"Select an object with an owner (a patent, a copyrighted song, a trade secret). Discuss the conflict between the owner's rights and the public's benefit."
      },
      { n:30, q:"What role does imagination play in producing knowledge about the world?",
        translation:"Did the creator have to 'imagine' this before it became real?",
        hidden:"Imagination isn't just fantasy; it's the bridge to new hypotheses and models.",
        guidance:"Choose an object that models reality (an architectural blueprint, a physics simulation, a sci-fi novel that predicted tech). Show how imagination was required to structure the facts."
      },
      { n:31, q:"How can we judge when we should trust our senses to give us truth?",
        translation:"Is what we see in this object actually what is there?",
        hidden:"Our senses are easily fooled (optical illusions) but are also our primary window to reality.",
        guidance:"Select an object that relies on sensory perception (art, an optical instrument, a food tasting). Discuss whether the senses provided accurate knowledge or a deception."
      },
      { n:32, q:"What makes a good explanation?",
        translation:"Does this object explain 'how' or 'why' well?",
        hidden:"A good explanation for a child is different from a good explanation for a scientist.",
        guidance:"Choose an object meant to explain something (a textbook diagram, a museum placard, an infographic). Judge it: did it simplify too much? Did it explain the cause or just the effect?"
      },
      { n:33, q:"How is current knowledge shaped by its historical development?",
        translation:"How does the past haunt this object?",
        hidden:"Path dependence. We use QWERTY keyboards not because they are best, but because of history.",
        guidance:"Select an object that carries traces of the past (a law based on old morals, a map with colonial borders). Show how the history is still visible in the current knowledge claim."
      },
      { n:34, q:"In what ways do our values affect our acquisition of knowledge?",
        translation:"Did we only learn this because we *wanted* to?",
        hidden:"Confirmation bias and motivated reasoning. We look for what we value.",
        guidance:"Choose an object that reflects the values of the learner. Why was this specific thing studied or collected? What values made it 'worth knowing'?"
      },
      { n:35, q:"In what ways do values affect the production of knowledge?",
        translation:"Did we only create this because it matched our values?",
        hidden:"Funding and focus follow values. We produce knowledge about what we care about (or what pays).",
        guidance:"Select an object that exists because of specific values (e.g., a vaccine funded by public health values, or an algorithm driven by profit values). Link the value to the product."
      },
    ];

    // derive KF labels for all prompts
    DATA.forEach(d => d.kf = inferKF(d));

    // Build filter list from fixed KF labels
    const kfFilter = document.getElementById("kfFilter");
    Object.keys(KF).forEach(label=>{
      const opt = document.createElement("option");
      opt.value = label;
      opt.textContent = `Knowledge Framework: ${label}`;
      kfFilter.appendChild(opt);
    });

    const grid = document.getElementById("grid");
    const search = document.getElementById("search");

    function render(){
      const q = (search.value || "").trim().toLowerCase();
      const f = kfFilter.value;

      const shown = DATA.filter(d=>{
        const hay = [d.q, d.translation, d.hidden, d.guidance, (d.kf||[]).join(" ")].join(" ").toLowerCase();
        const matchesSearch = !q || hay.includes(q);
        const matchesKF = (f==="all") || (d.kf||[]).includes(f);
        return matchesSearch && matchesKF;
      });

      grid.innerHTML = "";
      shown.forEach(d=>{
        const card = document.createElement("article");
        card.className = "card";
        card.tabIndex = 0;
        card.setAttribute("role","button");
        card.setAttribute("aria-label", `Open prompt ${d.n}: ${d.q}`);

        const primary = d.kf?.[0] || "Scope";
        const accent = kfColor(primary);

        card.innerHTML = `
          <div class="topline">
            <div class="num">${d.n}</div>
            <div class="pill"><span class="dot" style="background:${accent}"></span>${escapeHtml(primary)}</div>
          </div>
          <h3 class="q">${escapeHtml(d.q)}</h3>
          <p class="mini">${escapeHtml(d.guidance || d.hidden || d.translation || "")}</p>
          <div class="accentBar" style="background:${accent}"></div>
        `;

        card.addEventListener("click", ()=>openDrawer(d));
        card.addEventListener("keydown",(e)=>{
          if(e.key==="Enter" || e.key===" "){ e.preventDefault(); openDrawer(d); }
        });

        grid.appendChild(card);
      });
    }

    // Drawer
    const drawer = document.getElementById("drawer");
    const backdrop = document.getElementById("backdrop");
    const closeBtn = document.getElementById("closeBtn");
    const dTitle = document.getElementById("dTitle");
    const dMeta = document.getElementById("dMeta");
    const dBody = document.getElementById("dBody");

    function openDrawer(d){
      dTitle.textContent = `${d.n}. ${d.q}`;

      dMeta.innerHTML = "";
      (d.kf||[]).forEach(label=>{
        const pill = document.createElement("div");
        pill.className = "pill";
        pill.innerHTML = `<span class="dot" style="background:${kfColor(label)}"></span>${escapeHtml(label)}`;
        dMeta.appendChild(pill);
      });

      dBody.innerHTML = `
        ${section("Translation", d.translation)}
        ${section("Hidden problem / tension", d.hidden)}
        ${section("Knowledge framework focus", (d.kf||[]).join(" • "))}
        ${section("Exhibition guidance (The Object)", d.guidance)}
      `;

      drawer.classList.add("open");
      backdrop.classList.add("show");
      backdrop.setAttribute("aria-hidden","false");
      closeBtn.focus();
      document.body.style.overflow = "hidden";
    }

    function closeDrawer(){
      drawer.classList.remove("open");
      backdrop.classList.remove("show");
      backdrop.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    backdrop.addEventListener("click", closeDrawer);
    closeBtn.addEventListener("click", closeDrawer);
    document.addEventListener("keydown",(e)=>{
      if(e.key==="Escape" && drawer.classList.contains("open")) closeDrawer();
    });

    function section(label, text){
      if(!text) return "";
      return `
        <div class="section">
          <div class="label">${escapeHtml(label)}</div>
          <p class="text">${escapeHtml(text)}</p>
        </div>
      `;
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // listeners
    search.addEventListener("input", render);
    kfFilter.addEventListener("change", render);

    render();
  </script>
</body>
</html>
